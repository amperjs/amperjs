import createApp from "{{importPathmap.core}}/app";

import router from "./router";

export default () => {
  const app = createApp();

  // routes goes latest
  app.use(router.routes());

  return app;
};

/**
 * In dev mode, determines whether to pass the request to API handler or to Vite.
export const devMiddlewareFactory: import("@oreum/api").DevMiddlewareFactory = (
  app,
) => {
  return (req, res, next) => {
    return req.url?.startsWith("...")
      ? app?.callback()(req, res) // send request to api handler
      : next(); // send request to vite dev server
  };
};
 * */

/**
 * In dev mode, used to cleanup before reloading api handler.
export const teardownHandler: import("@oreum/api").TeardownHandler = () => {
  // close db connections, server sockets etc.
};
 * */
