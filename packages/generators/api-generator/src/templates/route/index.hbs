import {
  defineRoute as $defineRoute,
  type DefineRouteHelpers,
  type RouteDefinitionItem,
} from "@oreum/api";

type ParamsTuple = [{{#each params}}unknown?,{{/each}}];

type ParamsMapper<T extends ParamsTuple> = {
  {{#each params}}
  "{{name}}"{{#unless isRequired}}?{{/unless}}: T[{{@index}}] extends undefined
      ? string
      : T[{{@index}}]{{#unless isRequired}} | undefined{{/unless}};
  {{/each}}
};

export const defineRoute: <
  P extends ParamsTuple = [{{#each params}}string{{#unless isRequired}}?{{/unless}},{{/each}}],
  S extends object = object,
  C extends object = object
>(
  factory: (
    helpers: DefineRouteHelpers<ParamsMapper<P>, S, C>,
  ) => Array<RouteDefinitionItem>,
) => Array<RouteDefinitionItem> = $defineRoute;
